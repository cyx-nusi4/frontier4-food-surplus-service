<!-- Main content -->
<div class="content-container">
  <div class="mb-4">
    <h1 class="display-5 mb-0">
      <i class="fas fa-database me-2"></i>Database Testing Tool
    </h1>
    <p class="text-muted">Test and query rules, messages, and file records in the database</p>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="fas fa-chart-bar me-2"></i>Database Statistics
          </h5>
          <button id="refreshStats" class="btn btn-sm btn-primary">
            <i class="fas fa-sync-alt me-1"></i>Refresh
          </button>
        </div>
        <div class="card-body">
          <div class="row" id="dbStats">
            <div class="col-md-4 mb-3">
              <div class="stats-card">
                <div class="stats-value" id="totalRules">-</div>
                <div class="stats-label">Total Rules</div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="stats-card">
                <div class="stats-value" id="totalSessions">-</div>
                <div class="stats-label">Total Sessions</div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="stats-card">
                <div class="stats-value" id="totalMessages">-</div>
                <div class="stats-label">Total Messages</div>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="mb-2">Rule Types</h6>
                  <ul class="list-unstyled">
                    <li><i class="fas fa-key text-primary me-2"></i>Keyword Rules: <span id="keywordRules">-</span></li>
                    <li><i class="fas fa-code text-success me-2"></i>Regex Rules: <span id="regexRules">-</span></li>
                    <li><i class="fas fa-function text-warning me-2"></i>Function Rules: <span id="functionRules">-</span></li>
                  </ul>
                </div>
                <div>
                  <h6 class="mb-2">Rule Attributes</h6>
                  <ul class="list-unstyled">
                    <li><i class="fas fa-bolt text-primary me-2"></i>Built-in Rules: <span id="builtinRules">-</span></li>
                    <li><i class="fas fa-user text-primary me-2"></i>Custom Rules: <span id="customRules">-</span></li>
                    <li><i class="fas fa-check text-success me-2"></i>Active Rules: <span id="activeRules">-</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-filter me-2"></i>Data Query Options
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Rule Types</label>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-sm btn-outline-primary query-preset" data-sql="SELECT * FROM rules ORDER BY priority DESC, id ASC">
                All Rules
              </button>
              <button class="btn btn-sm btn-outline-primary query-preset" data-sql="SELECT * FROM rules WHERE rule_type = 'keyword'">
                Keyword Rules
              </button>
              <button class="btn btn-sm btn-outline-primary query-preset" data-sql="SELECT * FROM rules WHERE rule_type = 'regex'">
                Regex Rules
              </button>
              <button class="btn btn-sm btn-outline-primary query-preset" data-sql="SELECT * FROM rules WHERE rule_type = 'function'">
                Function Rules
              </button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Rule Attributes</label>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-sm btn-outline-success query-preset" data-sql="SELECT * FROM rules WHERE is_builtin = 1">
                Built-in Rules
              </button>
              <button class="btn btn-sm btn-outline-success query-preset" data-sql="SELECT * FROM rules WHERE is_builtin = 0">
                Custom Rules
              </button>
              <button class="btn btn-sm btn-outline-success query-preset" data-sql="SELECT * FROM rules WHERE is_active = 1">
                Active Rules
              </button>
              <button class="btn btn-sm btn-outline-success query-preset" data-sql="SELECT * FROM rules WHERE is_active = 0">
                Disabled Rules
              </button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Other Data</label>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-sm btn-outline-info query-preset" data-sql="SELECT * FROM messages ORDER BY timestamp DESC LIMIT 20">
                Recent Messages
              </button>
              <button class="btn btn-sm btn-outline-info query-preset" data-sql="SELECT * FROM sessions ORDER BY last_activity DESC">
                Session List
              </button>
              <button class="btn btn-sm btn-outline-info query-preset" data-sql="SELECT * FROM uploads ORDER BY upload_time DESC">
                Uploaded Files
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-terminal me-2"></i>SQL Query Tool
          </h5>
        </div>
        <div class="card-body">
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>This tool is for testing purposes only and is only available in debug mode. Only SELECT queries are allowed.
          </div>

          <div class="mb-3">
            <label for="sqlQuery" class="form-label">SQL Query</label>
            <textarea id="sqlQuery" class="form-control"></textarea>
          </div>

          <div class="d-flex justify-content-between">
            <div>
              <button class="btn btn-secondary" id="loadSampleQueriesBtn">
                <i class="fas fa-list me-1"></i>Sample Queries
              </button>
            </div>
            <button class="btn btn-primary" id="executeQueryBtn">
              <i class="fas fa-play me-1"></i>Execute Query
            </button>
          </div>

          <div class="sample-queries mt-3" style="display: none;">
            <div class="list-group">
              <button class="list-group-item list-group-item-action sample-query">SELECT * FROM rules ORDER BY priority DESC, id ASC</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT rule_type, COUNT(*) as count FROM rules GROUP BY rule_type</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT COUNT(*) as cnt, is_active, is_builtin FROM rules GROUP BY is_active, is_builtin</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT * FROM rules WHERE rule_type = 'keyword' AND is_active = 1</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT * FROM messages ORDER BY timestamp DESC LIMIT 10</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT * FROM uploads</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT session_id, COUNT(*) as msg_count FROM messages GROUP BY session_id ORDER BY msg_count DESC</button>
              <button class="list-group-item list-group-item-action sample-query">SELECT * FROM sessions ORDER BY last_activity DESC</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0" id="queryResultsTitle">
            <i class="fas fa-table me-2"></i>Query Results
          </h5>
          <div id="resultCount"></div>
        </div>
        <div class="card-body">
          <div id="queryResults">
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>Execute a query to view results.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>